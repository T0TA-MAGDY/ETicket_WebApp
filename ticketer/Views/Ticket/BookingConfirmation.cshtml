@model ticketer.Models.TicketOrder

@{
    ViewBag.Title = "Booking Confirmation";
}
<link rel="stylesheet" href="~/css/confirmation.css" />
<h2 style="text-align: center; margin-bottom: 30px;" class="hover-zoom">üéüÔ∏è Booking Confirmation</h2>

<div class="confirmation-container">
    <h4 style="margin-bottom: 15px;" class="zoom">Booking Details</h4>
    <div style="margin-bottom: 25px;">
        <p ><strong>Order ID:</strong> @Model.Order_Id</p>
        <p ><strong>Booking Date:</strong> @Model.BookingTime.ToString("yyyy-MM-dd HH:mm:ss")</p>
        <p ><strong>Total Seats:</strong> @Model.Amount</p>
        <p ><strong>Total Price:</strong> $@Model.TotalPrice</p>
        <p ><strong>Payment Status:</strong> @Model.PaymentStatus</p>
    </div>

    <h4  style="margin-bottom: 15px;">Seats Booked</h4>
    <div  style="margin-bottom: 25px;">
        <table class="table hover-zoom">
            <thead>
                <tr>
                    <th>Seat No.</th>
                    <th>Row</th>
                    <th>Type</th>
                    <th>Price</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var ticket in Model.Tickets)
                {
                    <tr>
                        <td>@ticket.SeatNumber</td>
                        <td>@ticket.RowNumber</td>
                        <td>@ticket.SeatType</td>
                        <td>
                            $@(ticket.SeatType == "Premium" ? ticket.timing.Price + 50 : ticket.timing.Price)
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <h4 style="margin-bottom: 15px;">Showtime Details</h4>
    <div style="margin-bottom: 25px;">
        <p ><strong>Movie:</strong> @Model.Tickets.FirstOrDefault()?.timing?.Showtime?.Movie?.Name</p>
        <p ><strong>Cinema:</strong> @Model.Tickets.FirstOrDefault()?.timing?.Showtime?.Cinema?.Name</p>
        <p ><strong>Date:</strong> @Model.Tickets.FirstOrDefault()?.timing?.Showtime?.Date.ToString("yyyy-MM-dd")</p>
        <p ><strong>Time:</strong> @Model.Tickets.FirstOrDefault()?.timing?.StartTime.ToString(@"hh\:mm")</p>
    </div>

    <div class="button-section">
        <a class="btn back-btn hover-zoom" asp-controller="Movie" asp-action="Index">Back to Movie List</a>
        <button id="fake-paypal-button" class="hover-zoom">
            <img src="https://www.paypalobjects.com/webstatic/mktg/logo/pp_cc_mark_111x69.jpg" alt="PayPal" />
            Pay with PayPal
        </button>
    </div>

    @if (Model.PaymentStatus == "Paid")
    {
        <div style="margin-top: 100px; text-align: center;" class="hover-zoom">
            <h4>Payment Confirmation</h4>
            <p>Thank you for your purchase. Your tickets have been successfully booked. üéüÔ∏è</p>
        </div>
    }

    <div id="loading-spinner" class="hover-zoom">
        <img src="https://i.gifer.com/ZZ5H.gif" alt="Loading..." />
        <p>Processing Payment...</p>
    </div>
</div>



@section Scripts {
    <script>
        document.getElementById('fake-paypal-button').addEventListener('click', function () {
            var button = this;
            button.disabled = true;
            button.innerText = 'Processing...';
            button.style.backgroundColor = '#006AB6';
            button.style.transform = 'scale(0.98)';

            document.getElementById('loading-spinner').style.display = 'block';

            setTimeout(function () {
                var orderId = '@Model.Order_Id';
                var url = '@Url.Action("ConfirmPaymentAndBookSeats", "Ticket", new { orderId = "__orderId__" })';
                url = url.replace("__orderId__", orderId);

                window.location.href = url;
            }, 2000);
        });
    </script>
    <script src="~/js/main.js"></script>
}
